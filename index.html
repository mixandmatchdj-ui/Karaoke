<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Petits KaraokÃ©s</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        :root {
            --orange: #FF6B35;
            --bleu: #004E89;
            --bleu-clair: #1B6CA8;
            --bleu-tres-clair: #3B7CAA;
        }
        
        .bg-gradient-main {
            background: linear-gradient(135deg, #1a1a2e 0%, var(--bleu) 50%, #0f3a66 100%);
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .modal-overlay {
            display: none;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .btn-orange {
            background: linear-gradient(135deg, var(--orange) 0%, #FF8C42 100%);
        }
        
        .btn-orange:hover {
            background: linear-gradient(135deg, #E55A1F 0%, #FF7A2A 100%);
        }
        
        .accent-orange {
            color: var(--orange);
        }
        
        .border-orange {
            border-color: var(--orange);
        }
        
        .bg-orange-light {
            background-color: rgba(255, 107, 53, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-main text-white">
    <div id="app">
        <!-- Header -->
        <header class="bg-black/50 backdrop-blur-md border-b border-orange-500/30 sticky top-0 z-40">
            <div class="max-w-6xl mx-auto px-4 py-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="text-3xl">ğŸ™ï¸</div>
                        <h1 class="text-4xl font-bold bg-gradient-to-r from-orange-500 to-blue-400 bg-clip-text text-transparent">
                            MES PETITS KARAOKES
                        </h1>
                    </div>
                    <div class="flex gap-2">
                        <button id="qrCodeBtn" class="p-2 hover:bg-white/10 rounded-lg transition-colors" title="QR Code">
                            âš™ï¸
                        </button>
                        <button id="settingsBtn" class="p-2 hover:bg-white/10 rounded-lg transition-colors" title="Parametres">
                            ğŸ”§
                        </button>
                    </div>
                </div>
                <p class="text-orange-200 text-sm">
                    <span id="songCount">Explorez votre collection de chansons</span>
                </p>
            </div>
        </header>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal-overlay fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-gradient-to-br from-gray-900 to-blue-900 border border-orange-500/30 rounded-lg p-6 max-w-md w-full max-h-96 overflow-y-auto">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">âš™ï¸ Configuration</h2>
                    <button id="closeSettingsBtn" class="p-1 hover:bg-white/10 rounded transition-colors cursor-pointer">
                        âœ•
                    </button>
                </div>

                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-semibold mb-2 text-orange-300">
                            ğŸ“‹ Google Sheet ID
                        </label>
                        <input
                            type="text"
                            id="sheetId"
                            placeholder="Copier depuis l'URL entre /d/ et /edit"
                            class="w-full px-3 py-2 bg-white/10 border border-orange-500/30 rounded focus:outline-none focus:border-orange-500 text-white text-sm"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2 text-orange-300">
                            ğŸ”‘ Cle API Google
                        </label>
                        <input
                            type="password"
                            id="apiKey"
                            placeholder="AIzaSy..."
                            class="w-full px-3 py-2 bg-white/10 border border-orange-500/30 rounded focus:outline-none focus:border-orange-500 text-white text-sm"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2 text-orange-300">
                            ğŸ”— URL Google Apps Script
                        </label>
                        <input
                            type="text"
                            id="scriptUrl"
                            placeholder="https://script.google.com/macros/d/..."
                            class="w-full px-3 py-2 bg-white/10 border border-orange-500/30 rounded focus:outline-none focus:border-orange-500 text-white text-sm"
                        />
                    </div>
                </div>

                <div class="space-y-3">
                    <button
                        id="saveConfigBtn"
                        class="w-full btn-orange px-4 py-2 rounded-lg font-semibold transition-all cursor-pointer"
                    >
                        ğŸ’¾ Enregistrer
                    </button>
                    <button
                        id="cancelConfigBtn"
                        class="w-full bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg font-semibold transition-all cursor-pointer"
                    >
                        Annuler
                    </button>
                </div>
            </div>
        </div>

        <!-- QR Code Modal -->
        <div id="qrCodeModal" class="modal-overlay fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-gradient-to-br from-gray-900 to-blue-900 border border-orange-500/30 rounded-lg p-6 max-w-md w-full">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">ğŸ“± QR Code</h2>
                    <button id="closeQrCodeBtn" class="p-1 hover:bg-white/10 rounded transition-colors cursor-pointer">
                        âœ•
                    </button>
                </div>

                <div id="qrCodeContainer" class="bg-white rounded-lg p-4 flex items-center justify-center mb-6">
                    <!-- QR Code sera gÃ©nÃ©rÃ© ici -->
                </div>

                <p class="text-center text-orange-200 text-sm mb-4">
                    Projetez ce QR code au debut du karaoke
                </p>

                <button
                    id="downloadQrBtn"
                    class="w-full btn-orange px-4 py-2 rounded-lg font-semibold transition-all cursor-pointer"
                >
                    â¬‡ï¸ Telecharger
                </button>
            </div>
        </div>

        <!-- Modal Chanson Selectionnee -->
        <div id="songModal" class="modal-overlay fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-gradient-to-br from-gray-900 to-blue-900 border border-orange-500/30 rounded-lg p-6 max-w-md w-full">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">ğŸ™ï¸ Selection</h2>
                    <button id="closeSongModalBtn" class="p-1 hover:bg-white/10 rounded transition-colors cursor-pointer">
                        âœ•
                    </button>
                </div>

                <div id="selectedSongInfo" class="mb-6 p-4 bg-orange-500/20 rounded-lg">
                    <p id="selectedSongName" class="text-xl font-bold text-white mb-1"></p>
                    <p id="selectedSongArtist" class="text-orange-300 text-sm"></p>
                </div>

                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-semibold mb-2 text-orange-300">
                            ğŸ‘¤ Votre Prenom(s)
                        </label>
                        <input
                            type="text"
                            id="prenomInput"
                            placeholder="Entrez votre prenom"
                            class="w-full px-3 py-2 bg-white/10 border border-orange-500/30 rounded focus:outline-none focus:border-orange-500 text-white text-sm"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2 text-orange-300">
                            ğŸª‘ Numero ou Nom de Table
                        </label>
                        <input
                            type="text"
                            id="tableInput"
                            placeholder="Ex: Table 5 ou Terrasse"
                            class="w-full px-3 py-2 bg-white/10 border border-orange-500/30 rounded focus:outline-none focus:border-orange-500 text-white text-sm"
                        />
                    </div>
                </div>

                <div id="submitError" class="hidden bg-red-500/20 border border-red-500 rounded p-3 mb-4">
                    <p id="submitErrorText" class="text-red-200 text-sm"></p>
                </div>

                <div id="submitSuccess" class="hidden bg-green-500/20 border border-green-500 rounded p-3 mb-4">
                    <p class="text-green-200 text-sm">âœ… Chanson enregistree !</p>
                </div>

                <div class="space-y-3">
                    <button
                        id="submitSongBtn"
                        class="w-full btn-orange px-4 py-2 rounded-lg font-semibold transition-all cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        âœ… Valider
                    </button>
                    <button
                        id="closeSongBtn"
                        class="w-full bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg font-semibold transition-all cursor-pointer"
                    >
                        Annuler
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto px-4 py-8">
            <!-- Configuration Required -->
            <div id="configRequired" class="bg-blue-500/20 border border-orange-500 rounded-lg p-6 mb-8 text-center">
                <div class="text-4xl mb-4">âš™ï¸</div>
                <h2 class="text-xl font-bold mb-2">Configuration requise</h2>
                <p class="text-orange-200 mb-4">
                    Cliquez sur la roue crantee pour configurer votre application
                </p>
                <button
                    id="openSettingsBtn"
                    class="btn-orange px-6 py-2 rounded-lg font-semibold cursor-pointer"
                >
                    ğŸ”§ Configurer maintenant
                </button>
            </div>

            <!-- Tabs -->
            <div id="tabsContainer" class="hidden flex flex-wrap gap-2 mb-8">
                <button class="tab-btn active px-6 py-3 rounded-lg font-semibold transition-all duration-300 btn-orange shadow-lg cursor-pointer" data-tab="all">
                    ğŸµ Toutes
                </button>
                <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-white/10 hover:bg-white/20 border border-orange-500/30 cursor-pointer" data-tab="duo">
                    ğŸ‘¥ Duos
                </button>
                <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-white/10 hover:bg-white/20 border border-orange-500/30 cursor-pointer" data-tab="top">
                    â­ Top Karaoke
                </button>
                <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-white/10 hover:bg-white/20 border border-orange-500/30 cursor-pointer" data-tab="search">
                    ğŸ” Selectionner
                </button>
            </div>

            <!-- Search Bar -->
            <div id="searchContainer" class="hidden mb-8">
                <div class="relative">
                    <span class="absolute left-4 top-4 text-orange-400">ğŸ”</span>
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="Chercher par artiste ou chanson..."
                        class="w-full pl-12 pr-4 py-3 bg-white/10 border border-orange-500/30 rounded-lg focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/50 text-white placeholder-orange-300 cursor-text"
                    />
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="hidden flex justify-center items-center py-12">
                <div class="animate-spin text-3xl">ğŸ™ï¸</div>
                <p class="ml-3 text-orange-300">Chargement des chansons...</p>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden bg-red-500/20 border border-red-500 rounded-lg p-4 mb-8">
                <p id="errorMessage" class="text-red-200 font-semibold mb-2"></p>
                <button
                    id="editConfigBtn"
                    class="mt-4 bg-red-500 hover:bg-red-600 px-4 py-2 rounded text-sm font-semibold transition-colors cursor-pointer"
                >
                    Modifier la configuration
                </button>
            </div>

            <!-- Results Count -->
            <div id="resultsCount" class="hidden mb-6 text-orange-300">
                <span id="resultText"></span>
            </div>

            <!-- Songs Grid -->
            <div id="songsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden text-center py-12">
                <div class="text-4xl mb-4 opacity-50">ğŸ™ï¸</div>
                <p class="text-orange-300 text-lg">Aucune chanson trouvee</p>
                <p class="text-orange-400 text-sm mt-2">Essayez une autre recherche ou changez de categorie</p>
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t border-orange-500/30 mt-12 bg-black/50">
            <div class="max-w-6xl mx-auto px-4 py-6 text-center text-orange-300 text-sm">
                Bienvenue a Mes Petits Karaokes ! Chantez vos meilleures chansons ğŸ™ï¸
            </div>
        </footer>
    </div>

    <script>
        // Ã‰tat global
        let allSongs = [];
        let filteredSongs = [];
        let currentTab = 'all';
        let currentSong = null;
        let config = {
            sheetId: '',
            apiKey: '',
            scriptUrl: ''
        };

        // Ã‰lÃ©ments du DOM
        const settingsBtn = document.getElementById('settingsBtn');
        const qrCodeBtn = document.getElementById('qrCodeBtn');
        const openSettingsBtn = document.getElementById('openSettingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const qrCodeModal = document.getElementById('qrCodeModal');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        const closeQrCodeBtn = document.getElementById('closeQrCodeBtn');
        const saveConfigBtn = document.getElementById('saveConfigBtn');
        const cancelConfigBtn = document.getElementById('cancelConfigBtn');
        const editConfigBtn = document.getElementById('editConfigBtn');
        const sheetIdInput = document.getElementById('sheetId');
        const apiKeyInput = document.getElementById('apiKey');
        const scriptUrlInput = document.getElementById('scriptUrl');
        const searchInput = document.getElementById('searchInput');
        const songsGrid = document.getElementById('songsGrid');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const configRequired = document.getElementById('configRequired');
        const tabsContainer = document.getElementById('tabsContainer');
        const searchContainer = document.getElementById('searchContainer');
        const resultsCount = document.getElementById('resultsCount');
        const resultText = document.getElementById('resultText');
        const emptyState = document.getElementById('emptyState');
        const songCount = document.getElementById('songCount');
        
        // Song Modal
        const songModal = document.getElementById('songModal');
        const closeSongModalBtn = document.getElementById('closeSongModalBtn');
        const selectedSongName = document.getElementById('selectedSongName');
        const selectedSongArtist = document.getElementById('selectedSongArtist');
        const prenomInput = document.getElementById('prenomInput');
        const tableInput = document.getElementById('tableInput');
        const submitSongBtn = document.getElementById('submitSongBtn');
        const closeSongBtn = document.getElementById('closeSongBtn');
        const submitError = document.getElementById('submitError');
        const submitErrorText = document.getElementById('submitErrorText');
        const submitSuccess = document.getElementById('submitSuccess');
        const qrCodeContainer = document.getElementById('qrCodeContainer');
        const downloadQrBtn = document.getElementById('downloadQrBtn');

        // Charger la configuration depuis localStorage
        function loadConfig() {
            const saved = localStorage.getItem('karaokeConfig');
            if (saved) {
                config = JSON.parse(saved);
                sheetIdInput.value = config.sheetId;
                apiKeyInput.value = config.apiKey;
                scriptUrlInput.value = config.scriptUrl;
                return true;
            }
            return false;
        }

        // Sauvegarder la configuration
        function saveConfig() {
            config.sheetId = sheetIdInput.value.trim();
            config.apiKey = apiKeyInput.value.trim();
            config.scriptUrl = scriptUrlInput.value.trim();
            
            if (!config.sheetId || !config.apiKey || !config.scriptUrl) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            localStorage.setItem('karaokeConfig', JSON.stringify(config));
            closeModal();
            fetchSongs();
        }

        // Ouvrir/Fermer les modals
        function openModal() {
            settingsModal.classList.add('active');
        }

        function closeModal() {
            settingsModal.classList.remove('active');
        }

        function openQrCodeModal() {
            qrCodeModal.classList.add('active');
            generateQRCode();
        }

        function closeQrCodeModal() {
            qrCodeModal.classList.remove('active');
        }

        function openSongModal(song) {
            currentSong = song;
            selectedSongName.textContent = song.nom;
            selectedSongArtist.textContent = song.artiste;
            prenomInput.value = '';
            tableInput.value = '';
            submitError.classList.add('hidden');
            submitSuccess.classList.add('hidden');
            submitSongBtn.disabled = false;
            submitSongBtn.textContent = 'âœ… Valider';
            songModal.classList.add('active');
            prenomInput.focus();
        }

        function closeSongModal() {
            songModal.classList.remove('active');
            currentSong = null;
        }

        // GÃ©nÃ©rer QR Code
        function generateQRCode() {
            qrCodeContainer.innerHTML = '';
            const currentUrl = window.location.href;
            new QRCode(qrCodeContainer, {
                text: currentUrl,
                width: 256,
                height: 256,
                colorDark: "#FF6B35",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // TÃ©lÃ©charger QR Code
        downloadQrBtn.addEventListener('click', () => {
            const canvas = qrCodeContainer.querySelector('canvas');
            if (canvas) {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = 'mes-petits-karaokes-qr-code.png';
                link.click();
            }
        });

        // RÃ©cupÃ©rer les chansons
        async function fetchSongs() {
            if (!config.sheetId || !config.apiKey) {
                return;
            }

            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            configRequired.classList.add('hidden');

            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.sheetId}/values/Liste?key=${config.apiKey}`;
                
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    handleError(data.error.message);
                } else if (data.values && data.values.length > 0) {
                    const rows = data.values.slice(1);
                    
                    allSongs = rows
                        .map((row) => ({
                            artiste: row[0] || '',
                            nom: row[1] || '',
                            duo: (row[2] || '').toLowerCase() === 'oui',
                            top: (row[3] || '').toLowerCase() === 'oui',
                            decompte: row[4] || 0
                        }))
                        .filter(song => song.nom && song.artiste);

                    if (allSongs.length === 0) {
                        handleError('Aucune chanson trouvee. Verifiez votre Google Sheet.');
                    } else {
                        songCount.textContent = `${allSongs.length} chansons disponibles`;
                        tabsContainer.classList.remove('hidden');
                        configRequired.classList.add('hidden');
                        filterSongs();
                        renderSongs();
                        loadingState.classList.add('hidden');
                    }
                } else {
                    handleError('Aucune donnee trouvee');
                }
            } catch (err) {
                handleError('Erreur de connexion: ' + err.message);
                console.error('Erreur:', err);
            }
        }

        // GÃ©rer les erreurs
        function handleError(message) {
            let friendlyMessage = message;
            if (message.includes('Invalid API key')) {
                friendlyMessage = 'âŒ Cle API invalide ou expiree.';
            } else if (message.includes('permission')) {
                friendlyMessage = 'âŒ Le Sheet n\'est pas public.';
            }
            
            errorMessage.textContent = friendlyMessage;
            errorState.classList.remove('hidden');
            loadingState.classList.add('hidden');
            tabsContainer.classList.add('hidden');
        }

        // Filtrer les chansons
        function filterSongs() {
            filteredSongs = allSongs;

            if (currentTab === 'duo') {
                filteredSongs = filteredSongs.filter(song => song.duo);
            } else if (currentTab === 'top') {
                filteredSongs = filteredSongs.filter(song => song.top);
            } else if (currentTab === 'search') {
                const searchTerm = searchInput.value.toLowerCase();
                filteredSongs = filteredSongs.filter(song =>
                    song.nom.toLowerCase().includes(searchTerm) ||
                    song.artiste.toLowerCase().includes(searchTerm)
                );
            }
        }

        // Afficher les chansons
        function renderSongs() {
            filterSongs();

            const count = filteredSongs.length;
            resultText.textContent = `${count} chanson${count !== 1 ? 's' : ''} trouvee${count !== 1 ? 's' : ''}`;
            resultsCount.classList.remove('hidden');

            if (filteredSongs.length === 0) {
                songsGrid.innerHTML = '';
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                songsGrid.innerHTML = filteredSongs.map((song, index) => `
                    <div class="group bg-gradient-to-br from-blue-500/20 to-orange-500/20 backdrop-blur border border-orange-500/30 rounded-lg p-4 hover:from-blue-500/40 hover:to-orange-500/40 transition-all duration-300 hover:shadow-lg hover:shadow-orange-500/30 cursor-pointer" onclick="selectSong('${song.nom.replace(/'/g, "\\'")}', '${song.artiste.replace(/'/g, "\\'")}')">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-white group-hover:text-orange-200 transition-colors">
                                    ${song.nom}
                                </h3>
                                <p class="text-orange-300 text-sm">${song.artiste}</p>
                            </div>
                            ${song.top ? '<span class="text-2xl ml-2 flex-shrink-0">â­</span>' : ''}
                        </div>

                        <div class="flex flex-wrap gap-2 mt-3">
                            ${song.duo ? '<span class="inline-flex items-center gap-1 bg-blue-500/40 px-2 py-1 rounded text-xs font-semibold text-blue-200">ğŸ‘¥ Duo</span>' : ''}
                            ${song.decompte && song.decompte > 0 ? `<span class="inline-block bg-orange-500/40 px-2 py-1 rounded text-xs text-orange-200">ğŸ“Š ${song.decompte}</span>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // SÃ©lectionner une chanson
        function selectSong(nom, artiste) {
            openSongModal({ nom, artiste });
        }

        // Soumettre la chanson
        async function submitSong() {
            const prenom = prenomInput.value.trim();
            const table = tableInput.value.trim();
            
            if (!prenom) {
                submitErrorText.textContent = 'Veuillez entrer votre prenom';
                submitError.classList.remove('hidden');
                return;
            }

            if (!table) {
                submitErrorText.textContent = 'Veuillez entrer votre numero ou nom de table';
                submitError.classList.remove('hidden');
                return;
            }

            if (!config.scriptUrl) {
                submitErrorText.textContent = 'Script URL non configuree';
                submitError.classList.remove('hidden');
                return;
            }

            submitSongBtn.disabled = true;
            submitSongBtn.textContent = 'â³ Valider...';

            try {
                const response = await fetch(config.scriptUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prenom: prenom,
                        chanson: currentSong.nom,
                        artiste: currentSong.artiste,
                        table: table
                    })
                });

                const result = await response.json();

                if (result.success) {
                    submitError.classList.add('hidden');
                    submitSuccess.classList.remove('hidden');
                    prenomInput.value = '';
                    tableInput.value = '';
                    
                    // Recharger les dÃ©comptes
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    fetchSongs();
                    
                    setTimeout(() => {
                        closeSongModal();
                    }, 1500);
                } else {
                    submitErrorText.textContent = 'Erreur: ' + (result.error || 'Erreur inconnue');
                    submitError.classList.remove('hidden');
                }
            } catch (err) {
                submitErrorText.textContent = 'Erreur de connexion: ' + err.message;
                submitError.classList.remove('hidden');
            } finally {
                submitSongBtn.disabled = false;
                submitSongBtn.textContent = 'âœ… Valider';
            }
        }

        // Event Listeners - Settings
        settingsBtn.addEventListener('click', openModal);
        qrCodeBtn.addEventListener('click', openQrCodeModal);
        openSettingsBtn.addEventListener('click', openModal);
        closeSettingsBtn.addEventListener('click', closeModal);
        closeQrCodeBtn.addEventListener('click', closeQrCodeModal);
        saveConfigBtn.addEventListener('click', saveConfig);
        cancelConfigBtn.addEventListener('click', closeModal);
        editConfigBtn.addEventListener('click', openModal);

        // Event Listeners - Song Modal
        closeSongModalBtn.addEventListener('click', closeSongModal);
        closeSongBtn.addEventListener('click', closeSongModal);
        submitSongBtn.addEventListener('click', submitSong);
        prenomInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') tableInput.focus();
        });
        tableInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitSong();
        });

        // Event Listeners - Tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active', 'btn-orange', 'shadow-lg');
                    b.classList.add('bg-white/10', 'border', 'border-orange-500/30');
                });
                e.target.classList.add('active', 'btn-orange', 'shadow-lg');
                e.target.classList.remove('bg-white/10', 'border', 'border-orange-500/30');
                currentTab = e.target.dataset.tab;
                
                if (currentTab === 'search') {
                    searchContainer.classList.remove('hidden');
                } else {
                    searchContainer.classList.add('hidden');
                }
                
                searchInput.value = '';
                renderSongs();
            });
        });

        // Event Listeners - Search
        searchInput.addEventListener('input', renderSongs);

        // Fermer les modals en cliquant en dehors
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) closeModal();
        });
        
        qrCodeModal.addEventListener('click', (e) => {
            if (e.target === qrCodeModal) closeQrCodeModal();
        });
        
        songModal.addEventListener('click', (e) => {
            if (e.target === songModal) closeSongModal();
        });

        // Initialiser l'app
        if (loadConfig()) {
            configRequired.classList.add('hidden');
            fetchSongs();
        } else {
            configRequired.classList.remove('hidden');
        }
    </script>
</body>
</html>
